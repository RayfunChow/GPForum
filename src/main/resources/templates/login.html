<!doctype html>
<html lang="zh-hans" class="h-100">
<head>
    <title>xxx的个人主页</title>
    {{>layout/head}}
    <link rel="stylesheet" href="/css/auth.css">
    <!-- Custom styles for this template -->
</head>

<body class="d-flex flex-column h-100" style="background: url(../img/loginbg.jpg) center top;">
{{>layout/navbar}}

<div >
    <main role="main" class="flex-shrink-0">
        <div class="container">
            <div class="row">
                <div class="col-7"></div>
                <div class="lowin col-5">
                    <div class="lowin-brand">
                        <!--<img src="kodinger.jpg" alt="logo">-->
                    </div>
                    <div class="lowin-wrapper">
                        <div class="lowin-box lowin-login">
                            <div class="lowin-box-inner">
                                <form id="signinForm">
                                    <p>登录到聚集地论坛</p>
                                    <div class="lowin-group">
                                        <label>Email <a href="#" class="login-back-link">Sign in?</a></label>
                                        <input type="email" autocomplete="email" name="email" class="lowin-input"
                                               id="Email">
                                    </div>
                                    <div class="lowin-group password-group">
                                        <label>密&nbsp;&nbsp;码 <a href="#" class="forgot-link"
                                                                 style="visibility: hidden">Forgot Password?</a></label>
                                        <input type="password" maxlength="16" name="password"
                                               autocomplete="current-password" class="lowin-input" id="Password">
                                    </div>
                                    <button class="lowin-btn login-btn" style="margin-top: 15px" onclick="signin()"
                                            type="button">
                                        登录
                                    </button>

                                    <div class="text-foot">
                                        还没有账户？ <a href="" class="register-link">现在注册</a>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="lowin-box lowin-register">
                            <div class="lowin-box-inner">
                                <form id="signupForm">
                                    <p>1分钟极速注册</p>
                                    <div class="lowin-group">
                                        <label>Email</label>
                                        <input type="email" name="email" autocomplete="email" class="lowin-input"
                                               id="userEmail">
                                    </div>
                                    <div class="lowin-group">
                                        <label>密&nbsp;&nbsp;码</label>
                                        <input type="password" maxlength="16" name="password" class="lowin-input"
                                               id="userPassword">
                                    </div>
                                    <div class="lowin-group">
                                        <label>确认密码</label>
                                        <input type="password" maxlength="16" name="confirmPassword" class="lowin-input"
                                               id="confirmPassword">
                                    </div>
                                    <div class="lowin-group">
                                        <label>验证码</label>

                                        <input type="text" name="veriCode" class="lowin-input col-5" id="veriCode">
                                        <a class="lowin-btn col-5" id="btnSendVeriCode"
                                           style="margin-top: 15px;margin-left: 46px">
                                            发送验证码
                                        </a>
                                    </div>
                                    <button class="lowin-btn" style="margin-top: 15px;" type="button"
                                            onclick="signup()">
                                        注册
                                    </button>

                                    <div class="text-foot">
                                        已有账户？ <a href="" class="login-link">现在登录</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <footer class="lowin-footer">
                        <!--Design By @itskodinger. More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a>-->
                    </footer>
                </div>
            </div>
        </div>
    </main>
</div>
{{>layout/footer}}

</body>

<script src="/js/auth.js"></script>
<script>
    Auth.init({
        login_url: '#login',
        forgot_url: '#forgot'
    });

    $().ready(function () {
// 在键盘按下并释放及提交后验证提交表单
        $("#signupForm").validate({
            rules: {
                email: "required",
                password: "required",
                confirmPassword: "required",
                veriCode: "required",
                password: {
                    required: true,
                    minlength: 6,
                    maxlength: 16
                },
                confirmPassword: {
                    required: true,
                    minlength: 6,
                    maxlength: 16
                    // equalTo: "#password"
                },
                email: {
                    required: true,
                    email: true
                },
                veriCode: {
                    required: true
                }

            },
            messages: {
                email: "请输入Email",
                password: "请输入密码",
                password: {
                    required: "请输入密码",
                    minlength: "密码长度不能小于 6 位",
                    maxlength: "密码长度不能大于 16 位"
                },
                confirm_password: {
                    required: "请输入密码",
                    minlength: "密码长度不能小于 6 位",
                    maxlength: "密码长度不能大于 16 位",
                    equalTo: "两次密码输入不一致"
                },
                email: "请输入一个正确的邮箱"
            }
        })
    });

    $("#btnSendVeriCode").click(function () {
        send();
    })

    function send() {

        var email = $("#userEmail").val();
        // alert(email);
        $.ajax({
            type: "post",
            url: "/sendCode",
            data: {"email": email},
            // dataType: "json",
            success: function (data) {
                alert(data);
            }
        });
    }

    function signin() {
        var email = $("#Email").val();
        var password = $("#Password").val();
        $.ajax({
            type: "post",
            url: "signinAction",
            data: {
                "email": email,
                "password": password
            },
            // dataType: "json",
            success: function (data) {
                if (data) {
                    window.location.href = 'index';
                } else {
                    alert("用户名或密码错误！");
                }
            }
        })
    }

    function signup() {
        var email = $("#userEmail").val();
        var password = $("#userPassword").val();
        var confirmPassword = $("#confirmPassword").val();
        var veriCode = $("#veriCode").val();
        $.ajax({
            type: "post",
            url: "signupAction",
            data: {
                "email": email,
                "password": password,
                "confirmPassword": confirmPassword,
                "veriCode": veriCode
            },
            // dataType: "json",
            success: function (data) {
                if (data == "注册成功") {
                    alert(data);
                    window.location.href = 'index';
                } else {
                    alert(data);
                }
            }
        })
    }
</script>

</html>
